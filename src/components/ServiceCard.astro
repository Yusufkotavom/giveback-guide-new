---
import ResponsiveImage from './ResponsiveImage.astro';
import { formatPrice } from '../utils/marketplaceUtils';

interface Props {
  service: {
    data: {
      properties: {
        svSlug: string;
        svImageURL1: string;
        svTitle: string;
        svProvider?: string;
        svWilayah?: string | string[];
        svCategory?: string | string[];
        svPrice?: string | number;
        svWhatsAppURL?: string;
      };
    };
  };
}

const { service } = Astro.props;
const p = service.data.properties as any;
const formattedPrice = formatPrice(p.svPrice);

// Default WA target if not provided in Notion
const DEFAULT_WA_NUMBER = '085799520350';
const waHref = p.svWhatsAppURL || `https://wa.me/62${DEFAULT_WA_NUMBER.replace(/^0/, '')}`;
---

<article class="rounded-lg">
  <div class="relative">
    <a href={`/services/${p.svSlug}/`}>
      <ResponsiveImage
        class="w-full rounded-lg h-64 object-cover"
        src={p.svImageURL1}
        alt={p.svTitle}
        preset="card"
        fallbackWidth={600}
      />
    </a>
  </div>

  <h2 class="mb-1 text-2xl font-bold tracking-tight text-gray-900 dark:text-white px-4 mt-4">
    <a href={`/services/${p.svSlug}/`}>{p.svTitle}</a>
  </h2>

  <!-- WhatsApp CTA under title -->
  <div class="px-4 mb-2">
    <a
      href={waHref}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700"
    >
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.965-.273-.099-.471-.149-.67.15-.198.297-.767.964-.94 1.162-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.521.149-.173.198-.297.298-.496.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.206-.242-.582-.487-.502-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.461 1.065 2.874 1.213 3.072.149.198 2.095 3.2 5.076 4.487.71.306 1.263.489 1.694.626.712.227 1.36.195 1.872.118.571-.085 1.758-.718 2.006-1.41.248-.694.248-1.289.173-1.41-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.86 9.86 0 01-1.51-5.234c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.12 1.03 6.988 2.899a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.886 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.33-1.654a11.88 11.88 0 005.713 1.456h.005c6.554 0 11.89-5.335 11.893-11.893a11.82 11.82 0 00-3.47-8.421"/></svg>
      <span class="font-semibold">Chat via WhatsApp</span>
      <span class="opacity-80">({DEFAULT_WA_NUMBER})</span>
    </a>
  </div>

  {formattedPrice && (
    <p class="px-4 mb-2 text-lg font-semibold text-green-600">{formattedPrice}</p>
  )}

  <p class="mt-2 text-sm font-normal text-gray-400 dark:text-gray-400 px-4">
    {p.svProvider && (<span class="text-gray-800">{p.svProvider}</span>)}
    {p.svType && (<span> adalah <span class="text-gray-900">{p.svType}</span></span>)}
    {p.svWilayah && (
      <span> di <span class="text-gray-900">
        {Array.isArray(p.svWilayah) ? p.svWilayah.join(', ') : p.svWilayah}
      </span></span>
    )}
  </p>
</article>